#!/usr/bin/env python

from __future__ import print_function

import sys
import rospy 

from open_manipulator_msgs.srv import *
from open_manipulator_msgs.msg import *

def move_in_joint_space(joint1, joint2, joint3, joint4, path_time):

    rospy.wait_for_service('goal_joint_space_path')

    try:
        setJointPath = rospy.ServiceProxy('goal_joint_space_path', SetJointPosition)

        request =  SetJointPosition()

        request.joint_position.joint_name = ["joint1", "joint2", "joint3", "joint4"]
        request.joint_position.position = [joint1, joint2, joint3, joint4]
        request.path_time = path_time

        response = setJointPath(request)

        return response.is_planned

    except rospy.ServiceException as e:

        print("Service call failed: %s"%e)

def move_gripper(gripper):

    rospy.wait_for_service('goal_tool_control')

    try:
        setGripperGap = rospy.ServiceProxy('goal_tool_control', SetJointPosition)

        request =  SetJointPosition()

        request.joint_position.joint_name = ["gripper"]
        request.joint_position.position = [gripper]
        request.path_time = path_time

        response = setJointPath(request)

        return response.is_planned

    except rospy.ServiceException as e:

        print("Service call failed: %s"%e)

def activate_actuators(state):

    rospy.wait_for_service('set_actuator_state')

    try:

        activate = rospy.ServiceProxy('set_actuator_state', SetActuatorState)
        
        request = SetActuatorState()

        request.set_actuator_state = state

        response =  activate(request)

        return response.is_planned

    except rospy.ServiceException as e:

        print("Service call failed: %s"%e)

if __name__ == "__main__":
    activate_actuators(True)

    move_in_joint_space(0.0, 0.0, 0.0, 0.0, 2.0)
    move_gripper(0.00)

    move_in_joint_space(0.2, 0.0, 0.0, 0.0, 5.0)
    move_gripper(0.05)

    move_in_joint_space(0.0, 0.2, 0.0, 0.0, 2.0)
    move_gripper(0.10)

    move_in_joint_space(0.0, 0.0, 0.0, 0.2, 5.0)
    move_gripper(-0.05)

    move_in_joint_space(0.0, 0.2, 0.0, 0.0, 2.0)
    move_gripper(-0.1)

    activate_actuators(False)